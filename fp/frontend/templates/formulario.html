
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cotizador</title>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
</head>
<body class="w3-container">
  <h2>Cotizador de Ladrillos y Mortero</h2>
  <form id="calcForm" class="w3-card w3-padding">
    <p>
      <label>Tipo de ladrillo:</label>
      <select id="material" class="w3-select"></select>
    </p>
    <p>
      <label>Espesor de pared (cm):</label>
      <input type="number" id="espesor" value="25" class="w3-input">
    </p>
    <p>
      <label>Área de pared (m²):</label>
      <input type="number" id="area" step="0.1" class="w3-input">
    </p>
    <p>
      <label>Usar mortero premezclado?</label>
      <select id="pre_mix" class="w3-select">
        <option value="">-- No usar --</option>
      </select>
    </p>
    <button type="button" class="w3-button w3-teal" onclick="calcular()">Calcular</button>
  </form>
  <h3>Resultado:</h3>
  <pre id="resultado" class="w3-code"></pre>
  <script>
    async function cargarMateriales() {
      const res = await fetch("/api/materials");
      const data = await res.json();
      const select = document.getElementById("material");
      data.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m.id;
        opt.textContent = m.name;
        select.appendChild(opt);
      });
    }
    async function cargarPreMixes() {
      const res = await fetch("/api/pre_mixes");
      const data = await res.json();
      const select = document.getElementById("pre_mix");
      data.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name + " (" + p.uso + ")";
        select.appendChild(opt);
      });
    }
    async function calcular() {
      const area = parseFloat(document.getElementById("area").value);
      const espesor = parseFloat(document.getElementById("espesor").value);
      const material_id = document.getElementById("material").value;
      const pre_mix_id = document.getElementById("pre_mix").value;
      const use_pre_mix = pre_mix_id !== "";
      const res = await fetch("/api/cotizar", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({area, espesor, material_id, use_pre_mix, pre_mix_id: pre_mix_id || null})
      });
      const data = await res.json();
      document.getElementById("resultado").textContent = JSON.stringify(data, null, 2);
    }
    cargarMateriales();
    cargarPreMixes();
  </script>
</body>
</html>
